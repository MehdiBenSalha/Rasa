flows:
  main_cooking_flow:
    description: Main entry point - asks for dietary restrictions once, then routes to sub-flows
    steps: 
      - collect: cooking_choice
        description: ask if user wants to search by recipe name or by ingredients
        next:
          - if: slots.cooking_choice == "recipe" or slots.cooking_choice == "1" or slots.cooking_choice == "name" or slots.cooking_choice == "recipe name" or slots.cooking_choice == "by recipe"
            then:
              - link: return_based_on_recipe
          - else:
            - link: recipes_from_ingredients

  return_based_on_recipe:
    description: Help the user cook a recipe by name (restrictions already collected in main flow)
    steps:
      - collect: dietary_restrictions
        description: dietary restrictions
      - collect: recipe
        utter: utter_ask_recipe_name

        description: the name of the recipe
      - action: action_get_ingredients
        next:
          - if: slots.recipe_valid
            then:
              - collect: wants_instructions
                description: ask if they want instructions
                next:
                  - if: slots.wants_instructions == "yes"
                    then:
                      - action: action_get_instructions
                      - action: action_utter_recipe_complete
                      
                      - link: continue_flow
                  - else:
                        - link: continue_flow

          - else:
            - action: utter_recipe_not_found
              next: END
  
  recipes_from_ingredients:
    description: Suggest recipes based on ingredients 
    steps:
      - collect: dietary_restrictions
        description: dietary restrictions
      - collect: ingredients
        description: ingredients provided by the user
      - action: action_suggest_recipes
      - collect: recipe
        description: recipe chosen by the user
      - action: action_get_ingredients
        next:
          - if: slots.recipe_valid
            then:
              - collect: wants_instructions
                description: ask if they want instructions
                next:
                  - if: slots.wants_instructions == "yes"
                    then:
                      - action: action_get_instructions
                      - action: action_utter_recipe_complete
                        
                      - link: continue_flow

                  - else:
                    - link: continue_flow
          - else:
            - action: utter_recipe_not_found
              next: END
  continue_flow:
    description: Ask user if they want another recipe and route accordingly
    steps:
      - collect: continue_conversation
        utter: utter_ask_continue_conversation
        next:
          - if: slots.continue_conversation == true
            then:
              - action: action_reset_recipe_context
              - link: main_cooking_flow
          - else:
              - action: utter_help_refused
                next: END
